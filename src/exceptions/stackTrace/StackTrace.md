# Stack trace

Списъкът, състоящ се от текущия метод, метода, който го е извикал, неговият извикващ метод и т.н., се нарича __stack trace__.

__Stack trace__ е стандартно средство за дебъгване, т.е. за търсене и отстраняване на проблеми. Той съдържа голямо количество информация и се използва при "хвърлянето" на Exception.
 
 Когато в програмата възникне грешка и бъде генерирано изключение, в него се записва текущият _stack trace_, за да бъде използван, за откриването на причините, за генериране на изключението, и за намирането на мястото в програмата, където то е възникнало.

Всяка Java програма стартира с main() метод, който изпълнява ролята на входяща точка. От него може да се извика друг метод, който от своя страна може да извиква друг метод и т.н. докато се извика "Метод N". Когато "Методът N" свърши работата си, управлението на програмата се връща на предхождащият го метод, когато предхождащият го метод свърши своята работа, управлението на програмата се връща на метода, който го е предхождал (и извикал) и т. н. докато се стигне до main() метода. След като main() метода бъде изпълнен, се излиза от него и програмата свършва.

````
метод main()    извиква метод 1
метод 1         извиква метод 2
метод 2         извиква метод N
метод N

````

Като се извиква нов метод, той се добавя най-отгоре в стека на извикване на методите, а като свърши изпълнението му, метода се изважда от стека.

> Бележка: Това е същият този стек, в който се записват всички променливи в програмата, параметрите на методите и стойностните типове.

Ако един метод хвърли изключение, виртуалната машина търси код, който да го прихване и обработи.

Процесът на търсене и прихващане на изключение, е обратният, на този на извикване на методи. Започва се от метода, в който е възникнало изключението и се върви в обратна посока, докато се намери метод, където изключението да бъде прихванато.

За прихващане и обработване на изключения се използва конструкцията try-catch.

````
Stack trace, в Java програма, може да бъде получен, без да е възникнало изключение, по следният начин:

StackTraceElement[] methods = Thread.currentThread().getStackTrace();

или

Thread current = Thread.currentThread();
StackTraceElement[] methods = current.getStackTrace();

Статичният метод .currentThread() на класа Thread, връща препратка към обекта от тип Thread.

От обектът Thread се извиква метода .getStackTrace();
Той връща масив от елементи от тип StackTraceElement;
Всеки от тези елементи съдържа информация за един метод;
Всички елементи заедно образуват stack trace-ът;

````

```java
public class MethodGetStackTrace {
    public static void main(String[] args){
        getTest();
    }

    public static void getTest(){
        Thread current = Thread.currentThread();
        StackTraceElement[] methods = current.getStackTrace();

        for(StackTraceElement info: methods) System.out.println(info);
    }
}

//Result:

//java.lang.Thread.getStackTrace(Thread.java:1559)                                       => Метода Thread.getStackTrace е извикан от метода MethodGetStackTrace.getTest
//exceptions.stackTrace.MethodGetStackTrace.getTest(MethodGetStackTrace.java:10)         => Метода MethodGetStackTrace.getTest е извикан от метода MethodGetStackTrace.main
//exceptions.stackTrace.MethodGetStackTrace.main(MethodGetStackTrace.java:5)             => Метода MethodGetStackTrace.main е входна точка, него никой не го е извикал, той е първият метод от веригата на извикванията

````

Класът __StackTraceElement__, е предназначен да съхранява информация, за един елемент от тип stack trace - т.е. за един метод от StackTrace.

Методите на клас StackTraceElement са:

+ [String] getClassName() => Връща името на класа
+ [String] getMethodName() => Връща името на метода
+ [String] getFileName() => Връща името на файла (в един файл, може да има повече от един клас)
+ [int] getLineNumber() => Връща номера на реда във файла, в който е бил извикан методът
+ [String] getModuleName() => Връща името на модула (може да бъде null)
+ [String] getModuleVersion() => Връща версията на модула (може да бъде null)
